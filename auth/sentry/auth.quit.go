package sentry

import (
	"net/http"

	"github.com/ralphferrara/aria/responses"

	"github.com/ralphferrara/aria/auth/actions"
)

//||------------------------------------------------------------------------------------------------||
//|| Response
//||------------------------------------------------------------------------------------------------||

type responseQuit struct {
	QuitToken string `json:"quitToken"`
}

//||------------------------------------------------------------------------------------------------||
//|| QuitHandler â€“ serves token for delete confirmation
//||------------------------------------------------------------------------------------------------||

func QuitHandler(w http.ResponseWriter, r *http.Request) {
	//||------------------------------------------------------------------------------------------------||
	//|| Get the Session Cookie
	//||------------------------------------------------------------------------------------------------||
	_, account, _, err := actions.LoadSessionAccount(r)
	if err != nil {
		responses.Error(w, http.StatusUnauthorized, err.Error())
		return
	}
	//||------------------------------------------------------------------------------------------------||
	//|| Quit Token
	//||------------------------------------------------------------------------------------------------||
	token := actions.GenerateQuitToken(account.PrivateHash)
	//||------------------------------------------------------------------------------------------------||
	//|| Quit Token
	//||------------------------------------------------------------------------------------------------||
	responses.Success(w, http.StatusOK, responseQuit{
		QuitToken: token,
	})
}
