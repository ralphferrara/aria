package sentry

//||------------------------------------------------------------------------------------------------||
//|| Import
//||------------------------------------------------------------------------------------------------||

import (
	"net/http"

	"github.com/ralphferrara/aria/app"
	"github.com/ralphferrara/aria/auth/actions"
	"github.com/ralphferrara/aria/responses"
)

//||------------------------------------------------------------------------------------------------||
//|| Response
//||------------------------------------------------------------------------------------------------||

type authQuickResponse struct {
}

//||------------------------------------------------------------------------------------------------||
//|| Handler
//||------------------------------------------------------------------------------------------------||

func QuickCheckHandler(w http.ResponseWriter, r *http.Request) {

	//||------------------------------------------------------------------------------------------------||
	//|| Get the Session Cookie
	//||------------------------------------------------------------------------------------------------||

	cookie, err := r.Cookie("session")
	if err != nil || cookie.Value == "" {
		responses.Error(w, http.StatusUnauthorized, app.Err("Auth").Code("MISSING_SESSION_COOKIE"))
		return
	}

	//||------------------------------------------------------------------------------------------------||
	//|| Get Session
	//||------------------------------------------------------------------------------------------------||

	_, sErr := actions.FetchSession(cookie.Value)
	if sErr != nil {
		responses.Error(w, http.StatusUnauthorized, app.Err("Auth").Code("SESSION_LOOKUP_FAILED"))
		return
	}

	//||------------------------------------------------------------------------------------------------||
	//|| Quick Check
	//||------------------------------------------------------------------------------------------------||

	responses.Success(w, http.StatusOK, authQuickResponse{})

}
